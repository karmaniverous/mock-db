<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><link rel="canonical" href="https://docs.karmanivero.us/mock-db/"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@karmaniverous/mock-db</title><meta name="description" content="Documentation for @karmaniverous/mock-db"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="https://github.com/karmaniverous/mock-db" class="title">@karmaniverous/mock-db</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@karmaniverous/mock-db</h1></div><div class="tsd-panel tsd-typography"><h1 id="karmaniverousmock-db" class="tsd-anchor-link">@karmaniverous/mock-db<a href="#karmaniverousmock-db" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://www.npmjs.com/package/@karmaniverous/mock-db" target="_blank" class="external"><img src="https://img.shields.io/npm/v/@karmaniverous/mock-db.svg" alt="npm version"></a> <img src="https://img.shields.io/node/v/@karmaniverous/mock-db" alt="Node Current">  <a href="https://github.com/karmaniverous/mock-db/tree/main/LICENSE.md" target="_blank" class="external"><img src="https://img.shields.io/badge/license-BSD--3--Clause-blue.svg" alt="license"></a></p>
<p>MockDb is a tiny, test‑oriented helper that simulates a small subset of
Amazon DynamoDB behaviors over an in‑memory array of JSON objects. Its goal is
to make it easy to unit/integration test code that expects “Dynamo‑like”
reads without needing to provision a real database.</p>
<p>What you get:</p>
<ul>
<li>querySync and query — scan across all items or query a partition (hash key)</li>
<li>Optional sorting, filtering, limits, and pagination (pageKey)</li>
<li>Sync and async flavors (async returns with a normally‑distributed delay)</li>
</ul>
<p>What you do NOT get:</p>
<ul>
<li>A database. This is a small helper for tests, not a general data store.</li>
<li>The full DynamoDB API. Only a small, ergonomic subset of behavior.</li>
</ul>
<p>MockDb uses <a href="https://github.com/karmaniverous/entity-tools" target="_blank" class="external">@karmaniverous/entity-tools</a>
for type modeling and sorting.</p>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You’ll typically install this as a dev dependency:</p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> </span><span class="hl-3">-D</span><span class="hl-1"> </span><span class="hl-2">@karmaniverous/mock-db</span>
</code><button type="button">Copy</button></pre>

<p>Node: &gt;= 18 recommended (ESM module). The package ships both ESM and CJS outputs.</p>
<h2 id="quick-start" class="tsd-anchor-link">Quick start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="ts"><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-4">type</span><span class="hl-1"> { </span><span class="hl-5">Entity</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@karmaniverous/mock-db&#39;</span><span class="hl-1">; </span><span class="hl-6">// convenience re-export</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">MockDb</span><span class="hl-1">, </span><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-5">QueryOptions</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@karmaniverous/mock-db&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">interface</span><span class="hl-1"> </span><span class="hl-7">User</span><span class="hl-1"> </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-7">Entity</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">partition</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">; </span><span class="hl-6">// hash key</span><br/><span class="hl-1">  </span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">name</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">users</span><span class="hl-1">: </span><span class="hl-7">User</span><span class="hl-1">[] = [</span><br/><span class="hl-1">  { </span><span class="hl-5">partition:</span><span class="hl-1"> </span><span class="hl-2">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-9">4</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;Alice&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  { </span><span class="hl-5">partition:</span><span class="hl-1"> </span><span class="hl-2">&#39;b&#39;</span><span class="hl-1">, </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-9">3</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;Bob&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  { </span><span class="hl-5">partition:</span><span class="hl-1"> </span><span class="hl-2">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-9">2</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;Charlie&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  { </span><span class="hl-5">partition:</span><span class="hl-1"> </span><span class="hl-2">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;Dave&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">db</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">MockDb</span><span class="hl-1">(</span><span class="hl-5">users</span><span class="hl-1">); </span><span class="hl-6">// default async mean=100ms, std=20ms</span><br/><br/><span class="hl-6">// 1) Synchronous “scan” across all items with filter + sort</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">scan</span><span class="hl-1"> = </span><span class="hl-5">db</span><span class="hl-1">.</span><span class="hl-0">querySync</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">filter</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">id</span><span class="hl-1"> }) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> &gt; </span><span class="hl-9">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">sortOrder:</span><span class="hl-1"> [{ </span><span class="hl-5">property:</span><span class="hl-1"> </span><span class="hl-2">&#39;id&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">});</span><br/><span class="hl-6">// =&gt; { count: 2, items: [...], pageKey: undefined }</span><br/><br/><span class="hl-6">// 2) Asynchronous, paged, sorted “query” within a partition (hash key)</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">opts</span><span class="hl-1">: </span><span class="hl-7">QueryOptions</span><span class="hl-1">&lt;</span><span class="hl-7">User</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-5">hashKey:</span><span class="hl-1"> </span><span class="hl-2">&#39;partition&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">hashValue:</span><span class="hl-1"> </span><span class="hl-2">&#39;a&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">indexComponents:</span><span class="hl-1"> [</span><span class="hl-2">&#39;partition&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;id&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">limit:</span><span class="hl-1"> </span><span class="hl-9">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">sortOrder:</span><span class="hl-1"> [{ </span><span class="hl-5">property:</span><span class="hl-1"> </span><span class="hl-2">&#39;id&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-5">page</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">db</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-5">opts</span><span class="hl-1">, </span><span class="hl-9">100</span><span class="hl-1">);</span><br/><span class="hl-6">// =&gt; first two items plus pageKey for next page</span><br/><br/><span class="hl-5">page</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">db</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">({ ...</span><span class="hl-5">opts</span><span class="hl-1">, </span><span class="hl-5">pageKey:</span><span class="hl-1"> </span><span class="hl-5">page</span><span class="hl-1">.</span><span class="hl-5">pageKey</span><span class="hl-1"> }, </span><span class="hl-9">100</span><span class="hl-1">);</span><br/><span class="hl-6">// =&gt; next page (remaining items)</span>
</code><button type="button">Copy</button></pre>

<p>CommonJS example:</p>
<pre><code class="js"><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-8">MockDb</span><span class="hl-1"> } = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&#39;@karmaniverous/mock-db&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h2 id="api-overview" class="tsd-anchor-link">API overview<a href="#api-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="class-mockdbe-extends-entity-t-extends-transcodemap-defaulttranscodemap" class="tsd-anchor-link">class MockDb&lt;E extends Entity, T extends TranscodeMap = DefaultTranscodeMap&gt;<a href="#class-mockdbe-extends-entity-t-extends-transcodemap-defaulttranscodemap" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Replicates a limited set of DynamoDB scan/query behaviors over a local array.</p>
<p>Constructor</p>
<ul>
<li>new MockDb(data: E[], delayMean = 100, delayStd = 20)
<ul>
<li>delayMean/delayStd (ms) control async delay for query(...). querySync is always synchronous.</li>
</ul>
</li>
</ul>
<p>Methods</p>
<ul>
<li>querySync(options?: QueryOptions&lt;E, T&gt;): QueryReturn&lt;E, T&gt;</li>
<li>query(options?: QueryOptions&lt;E, T&gt;, delayMean?: number, delayStd?: number): Promise&lt;QueryReturn&lt;E, T&gt;&gt;</li>
</ul>
<h3 id="type-queryoptionse-t" class="tsd-anchor-link">type QueryOptions&lt;E, T&gt;<a href="#type-queryoptionse-t" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Options for query/querySync:</p>
<ul>
<li>hashKey?: TranscodableProperties&lt;E, T&gt;<br>
When provided with hashValue, restricts results to the “partition” (like DynamoDB query).</li>
<li>hashValue?: T[keyof T]</li>
<li>sortOrder?: SortOrder<E><br>
Sorting keys and directions; powered by entity‑tools’ sort.</li>
<li>filter?: (item: E) =&gt; unknown<br>
Predicate to include items.</li>
<li>limit?: number<br>
Maximum number of items to return.</li>
<li>pageKey?: E | Partial&lt;Pick&lt;E, TranscodableProperties&lt;E, T&gt;&gt;&gt;<br>
If set, results begin after this item (pagination).</li>
<li>indexComponents?: TranscodableProperties&lt;E, T&gt;[]<br>
When limit is reached, the returned pageKey contains only these properties; otherwise it will be the entire last item.</li>
</ul>
<h3 id="type-queryreturne-t" class="tsd-anchor-link">type QueryReturn&lt;E, T&gt;<a href="#type-queryreturne-t" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Result from query/querySync:</p>
<ul>
<li>count: number<br>
Count of items returned in this page (not the entire dataset).</li>
<li>items: E[]<br>
The data items in this page.</li>
<li>pageKey?: E | Pick&lt;E, TranscodableProperties&lt;E, T&gt;&gt;<br>
Present when limit was reached; pass back as options.pageKey to get the next page.</li>
</ul>
<h3 id="behavior-notes" class="tsd-anchor-link">Behavior notes<a href="#behavior-notes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Scan vs Query:
<ul>
<li>If hashKey + hashValue are omitted, behavior is a “scan” across all items.</li>
<li>If both are present, behavior is a “query” restricted to that partition.</li>
</ul>
</li>
<li>Sorting: Applied before pagination/filtering (like Dynamo’s sorted result sets).</li>
<li>Filtering: A plain predicate function; no Dynamo expression syntax.</li>
<li>Pagination: Provide limit; when the page is full, the last item’s indexComponents (or the entire item) is returned as pageKey. Pass it back to get the next page.</li>
<li>Async timing: query(...) simulates network latency with a normal distribution around delayMean (std delayStd). querySync(...) performs the same logic without delay.</li>
</ul>
<h2 id="reexported-convenience-types" class="tsd-anchor-link">Re‑exported convenience types<a href="#reexported-convenience-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>To avoid a direct dependency on @karmaniverous/entity‑tools in your imports, the following types are re‑exported:</p>
<pre><code class="ts"><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-4">type</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">Entity</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">SortOrder</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">TranscodeMap</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">DefaultTranscodeMap</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@karmaniverous/mock-db&#39;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>You can still import them from @karmaniverous/entity‑tools if you prefer.</p>
<h2 id="project-scripts-local" class="tsd-anchor-link">Project scripts (local)<a href="#project-scripts-local" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>Test: <code>npm test</code> (Vitest; coverage via V8)</li>
<li>Lint/format: <code>npm run lint</code> (ESLint) • <code>npm run lint:fix</code> (ESLint + Prettier)</li>
<li>Typecheck: <code>npm run typecheck</code> (tsc, no emit)</li>
<li>Build: <code>npm run build</code> (Rollup – ESM/CJS + dts)</li>
<li>Docs: <code>npm run docs</code> (TypeDoc)</li>
</ul>
<h2 id="typedocs" class="tsd-anchor-link">Typedocs<a href="#typedocs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>See the online <a href="https://docs.karmanivero.us/mock-db">API Documentation</a> for the complete, generated API reference.</p>
<h2 id="why-not-a-real-database" class="tsd-anchor-link">Why not a real database?<a href="#why-not-a-real-database" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This library is meant for fast, deterministic test runs where mocking a small
subset of Dynamo behaviors is sufficient (hash key filtering, sorting,
pagination). If you need to exercise full DynamoDB semantics, consider running
a local emulator or integration tests against a real service.</p>
<hr>
<p>Built for you with ❤️ on Bali! Find more tools &amp; templates on
<a href="https://github.com/karmaniverous" target="_blank" class="external">my GitHub Profile</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#karmaniverousmock-db"><span>@karmaniverous/mock-<wbr/>db</span></a><ul><li><a href="#installation"><span>Installation</span></a></li><li><a href="#quick-start"><span>Quick start</span></a></li><li><a href="#api-overview"><span>API overview</span></a></li><li><ul><li><a href="#class-mockdbe-extends-entity-t-extends-transcodemap-defaulttranscodemap"><span>class <wbr/>Mock<wbr/>Db&lt;<wbr/>E extends <wbr/>Entity, <wbr/>T extends <wbr/>Transcode<wbr/>Map = <wbr/>Default<wbr/>Transcode<wbr/>Map&gt;</span></a></li><li><a href="#type-queryoptionse-t"><span>type <wbr/>Query<wbr/>Options&lt;<wbr/>E, <wbr/>T&gt;</span></a></li><li><a href="#type-queryreturne-t"><span>type <wbr/>Query<wbr/>Return&lt;<wbr/>E, <wbr/>T&gt;</span></a></li><li><a href="#behavior-notes"><span>Behavior notes</span></a></li></ul></li><li><a href="#reexported-convenience-types"><span>Re‑exported convenience types</span></a></li><li><a href="#project-scripts-local"><span>Project scripts (local)</span></a></li><li><a href="#typedocs"><span>Typedocs</span></a></li><li><a href="#why-not-a-real-database"><span>Why not a real database?</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@karmaniverous/mock-db</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
